<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>22RT Drag Handicap Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }
    h1 {
      color: #f90;
      margin-bottom: 25px;
    }
    .inputs {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }
    .lane {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      width: 250px;
      box-sizing: border-box;
    }
    .lane h2 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    .lane label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
    }
    input[type="number"] {
      width: 110px;
      padding: 10px;
      margin: 5px 0 0 0;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      -moz-appearance: textfield;
      box-sizing: border-box;
    }
    button {
      padding: 12px 18px;
      margin-left: 8px;
      font-size: 18px;
      border-radius: 8px;
      background-color: #444;
      color: #fff;
      border: none;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    button:active {
      background-color: #666;
    }
    #results {
      margin-top: 25px;
      font-size: 1.3em;
      font-weight: 700;
      min-height: 2em;
    }
    .tree-container {
      display: flex;
      justify-content: center;
      gap: 100px;
      margin-top: 30px;
    }
    .tree {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .bulb {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin: 5px 0;
      background-color: #444;
      box-shadow: 0 0 5px #000;
      transition: background-color 0.25s ease;
    }
    .bulb.on-white {
      background-color: white;
      box-shadow: 0 0 10px white;
    }
    .bulb.on-yellow {
      background-color: yellow;
      box-shadow: 0 0 10px yellow;
    }
    .bulb.on-green {
      background-color: lime;
      box-shadow: 0 0 10px lime;
    }
    .bulb.on-red {
      background-color: red;
      box-shadow: 0 0 10px red;
    }
  </style>
</head>
<body>
  <h1>22RT Drag Handicap Simulator</h1>
  <div class="inputs">
    <div class="lane">
      <h2>–õ–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞</h2>
      <label for="rt1">RT:
        <input type="number" id="rt1" step="0.001" />
        <button type="button" data-rand="rt1">üé≤</button>
      </label>
      <label for="et1">ET:
        <input type="number" id="et1" step="0.001" />
        <button type="button" data-rand="et1">üé≤</button>
      </label>
      <label for="dial1">Dial-in:
        <input type="number" id="dial1" step="0.001" />
        <button type="button" data-rand="dial1">üé≤</button>
      </label>
    </div>
    <div class="lane">
      <h2>–ü—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞</h2>
      <label for="rt2">RT:
        <input type="number" id="rt2" step="0.001" />
        <button type="button" data-rand="rt2">üé≤</button>
      </label>
      <label for="et2">ET:
        <input type="number" id="et2" step="0.001" />
        <button type="button" data-rand="et2">üé≤</button>
      </label>
      <label for="dial2">Dial-in:
        <input type="number" id="dial2" step="0.001" />
        <button type="button" data-rand="dial2">üé≤</button>
      </label>
    </div>
  </div>
  <button type="button" id="startBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
  <div id="results"></div>
  <div class="tree-container">
    <div class="tree" id="tree1">
      <div class="bulb on-white"></div>
      <div class="bulb on-white"></div>
      <div class="bulb" id="y1_1"></div>
      <div class="bulb" id="y1_2"></div>
      <div class="bulb" id="y1_3"></div>
      <div class="bulb" id="g1"></div>
      <div class="bulb" id="r1"></div>
    </div>
    <div class="tree" id="tree2">
      <div class="bulb on-white"></div>
      <div class="bulb on-white"></div>
      <div class="bulb" id="y2_1"></div>
      <div class="bulb" id="y2_2"></div>
      <div class="bulb" id="y2_3"></div>
      <div class="bulb" id="g2"></div>
      <div class="bulb" id="r2"></div>
    </div>
  </div>
  <script>
    function rand(id) {
      const input = document.getElementById(id);
      if (id.includes('rt')) input.value = (Math.random() * 0.3 + 0.2).toFixed(3);
      else if (id.includes('et')) input.value = (Math.random() * 3 + 8).toFixed(3);
      else if (id.includes('dial')) input.value = (Math.random() * 3 + 8).toFixed(3);
    }

    function resetTree() {
      ["y1_1","y1_2","y1_3","g1","r1","y2_1","y2_2","y2_3","g2","r2"].forEach(id => {
        document.getElementById(id).className = 'bulb';
      });
      document.getElementById('results').innerText = '';
    }

    async function lightSequence(lane, delay, isRed) {
      await new Promise(r => setTimeout(r, delay * 1000));
      document.getElementById(`y${lane}_1`).classList.add('on-yellow');
      await new Promise(r => setTimeout(r, 400));
      document.getElementById(`y${lane}_2`).classList.add('on-yellow');
      await new Promise(r => setTimeout(r, 400));
      document.getElementById(`y${lane}_3`).classList.add('on-yellow');
      await new Promise(r => setTimeout(r, 400));
      if (isRed) {
        document.getElementById(`r${lane}`).classList.add('on-red');
      } else {
        document.getElementById(`g${lane}`).classList.add('on-green');
      }
    }

    async function startRace() {
      resetTree();
      const rt1 = parseFloat(document.getElementById('rt1').value);
      const et1 = parseFloat(document.getElementById('et1').value);
      const dial1 = parseFloat(document.getElementById('dial1').value);
      const rt2 = parseFloat(document.getElementById('rt2').value);
      const et2 = parseFloat(document.getElementById('et2').value);
      const dial2 = parseFloat(document.getElementById('dial2').value);

      if (
        isNaN(rt1) || isNaN(et1) || isNaN(dial1) ||
        isNaN(rt2) || isNaN(et2) || isNaN(dial2)
      ) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏!');
        return;
      }

      const delta = Math.abs(dial1 - dial2);
      const lane1delay = dial1 > dial2 ? 0 : delta;
      const lane2delay = dial2 > dial1 ? 0 : delta;

      const red1 = rt1 < 0;
      const red2 = rt2 < 0;

      await Promise.all([
        lightSequence(1, lane1delay, red1),
        lightSequence(2, lane2delay, red2)
      ]);

      const total1 = rt1 + et1;
      const total2 = rt2 + et2;

      const breakout1 = et1 < dial1;
      const breakout2 = et2 < dial2;

      let result = '';

      if (red1 && red2) {
        result = Math.abs(rt1) < Math.abs(rt2)
          ? '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–º–µ–Ω—å—à–∏–π —Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç)'
          : '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–º–µ–Ω—å—à–∏–π —Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç)';
      } else if (red1) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (—Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç —Å–ª–µ–≤–∞)';
      else if (red2) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (—Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç —Å–ø—Ä–∞–≤–∞)';
      else if (breakout1 && !breakout2) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–ª–µ–≤—ã–π breakout)';
      else if (!breakout1 && breakout2) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–ø—Ä–∞–≤—ã–π breakout)';
      else if (breakout1 && breakout2)
        result = et1 < et2 ? '–û–±–∞ breakout, –Ω–æ –ø–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è (–º–µ–Ω—å—à–∏–π)' : '–û–±–∞ breakout, –Ω–æ –ø–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è (–º–µ–Ω—å—à–∏–π)';
      else if (total1 === total2) result = '–ù–∏—á—å—è!';
      else result = total1 < total2 ? '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞' : '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞';

      
      const advantage1 = (dial1 - et1) + rt1;
      const advantage2 = (dial2 - et2) + rt2;

      const formatted1 = advantage1.toFixed(3);
      const formatted2 = advantage2.toFixed(3);
      const formulaResult = ` ( –ª–µ–≤–∞—è = ${formatted1}, –ø—Ä–∞–≤–∞—è = ${formatted2})`;

      result += formulaResult;

      document.getElementById('results').innerText = result;
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('button[data-rand]').forEach(btn => {
        btn.addEventListener('click', () => rand(btn.getAttribute('data-rand')));
      });
      document.getElementById('startBtn').addEventListener('click', startRace);
    });
  </script>
</body>
</html>

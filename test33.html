<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
<title>22RT Drag Handicap Simulator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #111;
    color: #eee;
    margin: 0;
    padding: 0;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
  h1 {
    color: #f90;
    margin: 10px 0;
    font-size: 1.8em;
    text-align: center;
  }
  .main-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
  }
  .lane {
    background: #222;
    padding: 10px;
    border-radius: 12px;
    width: 220px;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
  }
  .lane h2 {
    margin: 0;
    color: #f90;
    text-align: center;
  }
  .lane label {
    display: block;
    margin-top: 8px;
    font-weight: 600;
  }
  input[type="number"] {
    width: 90px;
    padding: 6px;
    font-size: 14px;
    border-radius: 6px;
    border: none;
    margin-top: 3px;
    text-align: center;
    background: #333;
    color: #fff;
  }
  button {
    padding: 6px 10px;
    font-size: 14px;
    border-radius: 6px;
    background-color: #444;
    color: #fff;
    border: none;
    cursor: pointer;
    margin-left: 4px;
    touch-action: manipulation;
  }
  button:hover {
    background-color: #666;
  }
  .tree-container {
    display: flex;
    justify-content: center;
    gap: 40px;
    padding: 5px 0;
  }
  .tree {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .bulb {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    margin: 3px 0;
    background-color: #333;
  }
  .bulb.on-white { background-color: white; }
  .bulb.on-yellow { background-color: yellow; }
  .bulb.on-green { background-color: lime; }
  .bulb.on-red { background-color: red; }
  #results {
    margin: 15px;
    font-size: 1.1em;
    font-weight: 700;
    text-align: center;
    min-height: 1.5em;
  }
  #randAllBtn {
    background-color: #f90;
    color: #111;
    font-weight: bold;
  }
  #startBtn {
    background-color: #0f0;
    color: #111;
    font-weight: bold;
    margin-left: 10px;
  }
  .buttons {
    text-align: center;
    margin-top: 5px;
  }
</style>
</head>
<body>
  <h1>22RT Drag Handicap Simulator</h1>
  <div class="main-container">
    <div class="lane">
      <h2>–õ–µ–≤–∞—è</h2>
      <label>RT:
        <input type="number" id="rt1" step="0.001" />
        <button type="button" data-rand="rt1">üé≤</button>
      </label>
      <label>ET:
        <input type="number" id="et1" step="0.001" />
        <button type="button" data-rand="et1">üé≤</button>
      </label>
      <label>Dial-in:
        <input type="number" id="dial1" step="0.001" />
        <button type="button" data-rand="dial1">üé≤</button>
      </label>
    </div>
    <div class="tree-container">
      <div class="tree" id="tree1">
        <div class="bulb on-white"></div>
        <div class="bulb on-white"></div>
        <div class="bulb" id="y1_1"></div>
        <div class="bulb" id="y1_2"></div>
        <div class="bulb" id="y1_3"></div>
        <div class="bulb" id="g1"></div>
        <div class="bulb" id="r1"></div>
      </div>
      <div class="tree" id="tree2">
        <div class="bulb on-white"></div>
        <div class="bulb on-white"></div>
        <div class="bulb" id="y2_1"></div>
        <div class="bulb" id="y2_2"></div>
        <div class="bulb" id="y2_3"></div>
        <div class="bulb" id="g2"></div>
        <div class="bulb" id="r2"></div>
      </div>
    </div>
    <div class="lane">
      <h2>–ü—Ä–∞–≤–∞—è</h2>
      <label>RT:
        <input type="number" id="rt2" step="0.001" />
        <button type="button" data-rand="rt2">üé≤</button>
      </label>
      <label>ET:
        <input type="number" id="et2" step="0.001" />
        <button type="button" data-rand="et2">üé≤</button>
      </label>
      <label>Dial-in:
        <input type="number" id="dial2" step="0.001" />
        <button type="button" data-rand="dial2">üé≤</button>
      </label>
    </div>
  </div>
  <div class="buttons">
    <button type="button" id="randAllBtn">üé≤ –†–∞–Ω–¥–æ–º –¥–ª—è –≤—Å–µ—Ö</button>
    <button type="button" id="startBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
  </div>
  <div id="results"></div>
  <script>
    function randomValueRT() {
      return Math.random() < 0.1 
        ? (-(Math.random() * 0.2 + 0.01)).toFixed(3) 
        : (Math.random() * 0.3 + 0.2).toFixed(3);
    }
    function randomValueET() { return (Math.random() * 3 + 8).toFixed(3); }
    function randomValueDial() { return (Math.random() * 3 + 8).toFixed(3); }
    function rand(id) {
      const input = document.getElementById(id);
      if (id.includes('rt')) input.value = randomValueRT();
      else if (id.includes('et')) input.value = randomValueET();
      else if (id.includes('dial')) input.value = randomValueDial();
    }
    function randAll() {
      ['rt1','et1','dial1','rt2','et2','dial2'].forEach(rand);
    }
    function resetTree() {
      ["y1_1","y1_2","y1_3","g1","r1","y2_1","y2_2","y2_3","g2","r2"].forEach(id => {
        document.getElementById(id).className = 'bulb';
      });
      document.getElementById('results').innerText = '';
    }
    async function lightSequence(lane, delay, isRed) {
      await new Promise(r => setTimeout(r, delay * 1000));
      document.getElementById(`y${lane}_1`).classList.add('on-yellow');
      await new Promise(r => setTimeout(r, 400));
      document.getElementById(`y${lane}_2`).classList.add('on-yellow');
      await new Promise(r => setTimeout(r, 400));
      document.getElementById(`y${lane}_3`).classList.add('on-yellow');
      await new Promise(r => setTimeout(r, 400));
      if (isRed) document.getElementById(`r${lane}`).classList.add('on-red');
      else document.getElementById(`g${lane}`).classList.add('on-green');
    }
    async function startRace() {
      resetTree();
      const rt1 = parseFloat(document.getElementById('rt1').value);
      const et1 = parseFloat(document.getElementById('et1').value);
      const dial1 = parseFloat(document.getElementById('dial1').value);
      const rt2 = parseFloat(document.getElementById('rt2').value);
      const et2 = parseFloat(document.getElementById('et2').value);
      const dial2 = parseFloat(document.getElementById('dial2').value);
      if ([rt1,et1,dial1,rt2,et2,dial2].some(v => isNaN(v))) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏!');
        return;
      }
      const delta = Math.abs(dial1 - dial2);
      const lane1delay = dial1 > dial2 ? 0 : delta;
      const lane2delay = dial2 > dial1 ? 0 : delta;
      const red1 = rt1 < 0;
      const red2 = rt2 < 0;
      await Promise.all([
        lightSequence(1, lane1delay, red1),
        lightSequence(2, lane2delay, red2)
      ]);
      const total1 = rt1 + et1;
      const total2 = rt2 + et2;
      const breakout1 = et1 < dial1;
      const breakout2 = et2 < dial2;
      let result = '';
      if (rt1===rt2 && et1===et2 && dial1===dial2) {
        result = '–ù–∏—á—å—è! –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–µ–∑–¥';
      } else if (red1 && red2) {
        result = Math.abs(rt1) < Math.abs(rt2)
          ? '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–º–µ–Ω—å—à–∏–π —Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç)'
          : '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–º–µ–Ω—å—à–∏–π —Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç)';
      } else if (red1) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (—Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç —Å–ª–µ–≤–∞)';
      else if (red2) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (—Ñ–∞–ª—å—Å—Ç–∞—Ä—Ç —Å–ø—Ä–∞–≤–∞)';
      else if (breakout1 && !breakout2) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–ª–µ–≤—ã–π breakout)';
      else if (!breakout1 && breakout2) result = '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (–ø—Ä–∞–≤—ã–π breakout)';
      else if (breakout1 && breakout2) {
        const diff1 = Math.abs(et1 - dial1);
        const diff2 = Math.abs(et2 - dial2);
        result = diff1 < diff2
          ? '–û–±–∞ breakout, –Ω–æ –ø–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è (–º–µ–Ω—å—à–∏–π –ø–µ—Ä–µ–±–æ—Ä)'
          : '–û–±–∞ breakout, –Ω–æ –ø–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è (–º–µ–Ω—å—à–∏–π –ø–µ—Ä–µ–±–æ—Ä)';
      } else if (total1 === total2) result = '–ù–∏—á—å—è!';
      else result = total1 < total2 ? '–ü–æ–±–µ–¥–∏–ª–∞ –ª–µ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞' : '–ü–æ–±–µ–¥–∏–ª–∞ –ø—Ä–∞–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞';
      const advantage1 = (et1 - dial1) + rt1;
      const advantage2 = (et2 - dial2) + rt2;
      result += ` (–ª–µ–≤–∞—è = ${advantage1.toFixed(3)}, –ø—Ä–∞–≤–∞—è = ${advantage2.toFixed(3)})`;
      document.getElementById('results').innerText = result;
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('button[data-rand]').forEach(btn => {
        btn.addEventListener('click', () => rand(btn.getAttribute('data-rand')));
      });
      document.getElementById('randAllBtn').addEventListener('click', randAll);
      document.getElementById('startBtn').addEventListener('click', startRace);
      randAll();
    });
  </script>
</body>
</html>
